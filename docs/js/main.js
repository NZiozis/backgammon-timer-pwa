const MATCH_PARAMETERS_KEY="matchParameters",GAME_STATE_KEY="gameState",ONE_SECOND_IN_MS=1e3,TEN_MINUTES_IN_MS=6e5,TEN_SECONDS_IN_MS=1e4,ActionType={START:"START",ROLL:"ROLL",OFFER_DOUBLE:"OFFER_DOUBLE",TAKE_DOUBLE:"TAKE_DOUBLE",END_TURN:"END_TURN",END_GAME:"END_GAME"};class Stack{constructor(){this.stack=[]}push(t){return this.stack.push(t),t}pop(){return console.assert(this.stack.length>0,"Must have element in stack to pop"),this.stack.pop()}clear(){this.stack=[]}peek(){return this.stack.at(-1)}len(){return this.stack.length}}class UndoRedoBuffer{constructor(){this.undo_stack=new Stack,this.redo_stack=new Stack}can_undo(){return this.undo_stack.len()>1}can_redo(){return this.redo_stack.len()>0}add_to_history(t){this.undo_stack.push(t),this.redo_stack.clear()}undo(){return this.redo_stack.push(this.undo_stack.pop()),this.redo_stack.peek()}redo(){return this.undo_stack.push(this.redo_stack.pop()),this.undo_stack.peek()}u_peek(){return this.undo_stack.peek()}r_peek(){return this.redo_stack.peek()}}class Action{constructor(t,n){this.type=t,this.actingPlayer=n,this.playerOneGames=gameState.playerOneGames,this.playerOneScore=gameState.playerOneScore,this.playerTwoGames=gameState.playerTwoGames,this.playerTwoScore=gameState.playerTwoScore,this.playerOneTotalTimeRemainingMs=gameState.playerOneTotalTimeRemainingMs,this.playerOneReserveTimeRemainingMs=gameState.playerOneReserveTimeRemainingMs,this.playerTwoTotalTimeRemainingMs=gameState.playerTwoTotalTimeRemainingMs,this.playerTwoReserveTimeRemainingMs=gameState.playerTwoReserveTimeRemainingMs,this.currentGameValue=gameState.currentGameValue}}class EndGameAction extends Action{constructor(t,n){super(ActionType.END_GAME,t),n!==void 0&&(this.currentGameValue=n)}}class RollAction extends Action{constructor(t,n,o){super(ActionType.ROLL,t),this.diceOne=n,this.diceTwo=o}}class StartAction extends Action{constructor(t){super(ActionType.START,t),this.playerToStart=t}}class EndTurnAction extends Action{constructor(t){super(ActionType.END_TURN,t)}}class OfferDoubleAction extends Action{constructor(t){super(ActionType.OFFER_DOUBLE,t),this.newGameValue=gameState.currentGameValue*2}}class TakeDoubleAction extends Action{constructor(t){super(ActionType.TAKE_DOUBLE,t),this.playerTaking=t,this.previousGameValue=gameState.currentGameValue,this.currentGameValue=gameState.currentGameValue*2}}const PlayerTurn={NEUTRAL:"NEUTRAL",PLAYER_ONE:"PLAYER_ONE",PLAYER_TWO:"PLAYER_TWO"};function getPlayerTurn(e){return e?PlayerTurn.PLAYER_ONE:PlayerTurn.PLAYER_TWO}const StartType={ALWAYS_RANDOM:"ALWAYS_RANDOM",FIRST_GAME_RANDOM:"FIRST_GAME_RANDOM",PLAYER_THAT_CLICKS:"PLAYER_THAT_CLICKS"},Theme={ORIGINAL:"ORIGINAL",RED_GREEN:"RED_GREEN",BLUE:"BLUE"},ThemeToColors=new Map([[Theme.ORIGINAL,{primary:"#1F2041",primary_c:"#417B5A",secondary:"#4B3F72",secondary_c:"#D0CEBA"}],[Theme.RED_GREEN,{primary:"red",primary_c:"#4f4f4f",secondary:"green",secondary_c:"white"}],[Theme.BLUE,{primary:"#6492e6",primary_c:"#386ad5",secondary:"#302ea9",secondary_c:"white"}]]);function setDefaultHide(e,t){t?e.forEach(function(n){const o=[...n.classList];o.includes("default_hidden")||(o.push("default_hidden"),n.classList=o.join(" "))}):e.forEach(function(n){const o=[...n.classList].filter(l=>l!=="default_hidden");n.classList=o.join(" ")})}const matchParameters={theme:Theme.ORIGINAL,playerOneName:"Player One",playerTwoName:"Player Two",useCube:!0,useDice:!0,useTimer:!0,startType:StartType.ALWAYS_RANDOM,totalGameTimeMs:6e5,reserveTimeMs:1e4,scoreLimit:7},handleMatchParametersChange={set(e,t,n){const o=document.querySelector("#player_one #main_ui"),l=document.querySelector("#player_two #main_ui");if(t==="theme"){const a=ThemeToColors.get(n),r=document.body;r.style.setProperty("--color-primary",a.primary),r.style.setProperty("--color-primary-contrast",a.primary_c),r.style.setProperty("--color-secondary",a.secondary),r.style.setProperty("--color-secondary-contrast",a.secondary_c)}else if(t==="playerOneName")document.getElementById("player_one_name").innerText=n;else if(t==="playerTwoName")document.getElementById("player_two_name").innerText=n;else if(t==="totalGameTimeMs")document.getElementById("player_one_total_time").innerText=formatTotalTime(n),document.getElementById("player_two_total_time").innerText=formatTotalTime(n);else if(t==="reserveTimeMs")document.getElementById("player_one_reserve_time").innerText=formatReserveTime(n),document.getElementById("player_two_reserve_time").innerText=formatReserveTime(n);else if(t==="scoreLimit")document.getElementById("sidebar_game_info").innerText=`Game to ${n}`;else if(t==="useCube"){const a=Array.from(document.getElementsByClassName("double_button")),r=document.getElementById("midline");n?(setDefaultHide([r],!1),setDefaultHide(a,!1)):(setDefaultHide([r],!0),setDefaultHide(a,!0))}else if(t==="useDice"){const a=Array.from(document.getElementsByClassName("roll_button")),r=Array.from(document.getElementsByClassName("done_main_ui")),m=Array.from(document.getElementsByClassName("done_roll_ui"));n?(setDefaultHide([...a,...m],!1),setDefaultHide(r,!0)):(setDefaultHide([...a,...m],!0),setDefaultHide(r,!1))}else if(t==="useTimer"){const a=Array.from(document.getElementsByClassName("player_time_container")),r=Array.from(document.getElementsByClassName("player_infinity"));n?(setDefaultHide(r,!0),setDefaultHide(a,!1)):(setDefaultHide(r,!1),setDefaultHide(a,!0))}else t==="startType"||console.warn(`Failed to account for match parameter ${t}`);return Reflect.set(e,t,n)}},observedMatchParameters=new Proxy(matchParameters,handleMatchParametersChange);function resetMatchParameters(){observedMatchParameters.playerOneName="Player One",observedMatchParameters.playerTwoName="Player Two",observedMatchParameters.useCube=!0,observedMatchParameters.useDice=!0,observedMatchParameters.useTimer=!0,observedMatchParameters.startType=StartType.ALWAYS_RANDOM,observedMatchParameters.totalGameTimeMs=6e5,observedMatchParameters.reserveTimeMs=1e4,observedMatchParameters.scoreLimit=7}const gameState={currentAction:null,currentGameValue:1,playerOneGames:0,playerOneScore:0,playerOneTotalTimeRemainingMs:6e5,playerOneReserveTimeRemainingMs:1e4,playerOneTimeoutId:null,playerTwoGames:0,playerTwoScore:0,playerTwoTotalTimeRemainingMs:6e5,playerTwoReserveTimeRemainingMs:1e4,playerTwoTimeoutId:null,forceStopTimer:!0,isPaused:!1},STARTING_ACTION=new EndGameAction(null);gameState.currentAction=STARTING_ACTION;const UNDO_REDO_BUFFER=new UndoRedoBuffer;UNDO_REDO_BUFFER.add_to_history(STARTING_ACTION);function hideUIElements(e){e.forEach(t=>{t.style.display="none"})}const handleGameStateChange={set(e,t,n){const o=document.querySelector("#player_one #main_ui"),l=document.querySelector("#player_one #roll_action_ui"),a=document.querySelector("#player_one #double_action_ui"),r=document.querySelector("#player_one #start_ui"),m=document.querySelector("#player_one_sidebar_buttons .undo_button"),c=document.querySelector("#player_one_sidebar_buttons .redo_button"),s=document.querySelector("#player_two #main_ui"),u=document.querySelector("#player_two #roll_action_ui"),d=document.querySelector("#player_two #double_action_ui"),y=document.querySelector("#player_two #start_ui"),g=document.querySelector("#player_two_sidebar_buttons .undo_button"),h=document.querySelector("#player_two_sidebar_buttons .redo_button"),_=document.getElementById("midline"),T=document.getElementById("doubling_cube"),f=window.matchMedia("(orientation: landscape)").matches;if(m.dataset.disabled=!UNDO_REDO_BUFFER.can_undo(),g.dataset.disabled=!UNDO_REDO_BUFFER.can_undo(),c.dataset.disabled=!UNDO_REDO_BUFFER.can_redo(),h.dataset.disabled=!UNDO_REDO_BUFFER.can_redo(),t==="currentAction"){const i=[];switch(n.type){case ActionType.START:i.push(l,a,r,u,d,y),n.playerToStart===PlayerTurn.PLAYER_ONE?(o.style.display="flex",i.push(s)):n.playerToStart===PlayerTurn.PLAYER_TWO&&(s.style.display="flex",i.push(o)),hideUIElements(i),observedGameState.isPaused||(observedGameState.forceStopTimer=!1,setupTimerForPlayer(n.playerToStart===PlayerTurn.PLAYER_ONE));break;case ActionType.ROLL:i.push(o,a,r,s,d,y),n.actingPlayer===PlayerTurn.PLAYER_ONE?(l.style.display="flex",i.push(u),document.querySelector("#player_one #dice_one_span").innerText=n.diceOne,document.querySelector("#player_one #dice_two_span").innerText=n.diceTwo):n.actingPlayer===PlayerTurn.PLAYER_TWO&&(u.style.display="flex",i.push(l),document.querySelector("#player_two #dice_one_span").innerText=n.diceOne,document.querySelector("#player_two #dice_two_span").innerText=n.diceTwo),hideUIElements(i);break;case ActionType.END_TURN:i.push(l,a,r,u,d,y),n.actingPlayer===PlayerTurn.PLAYER_ONE?(s.style.display="flex",i.push(o)):n.actingPlayer===PlayerTurn.PLAYER_TWO&&(o.style.display="flex",i.push(s)),hideUIElements(i),observedGameState.isPaused||setupTimerForPlayer(n.actingPlayer!==PlayerTurn.PLAYER_ONE);break;case ActionType.OFFER_DOUBLE:i.push(l,o,r,u,s,y,document.getElementById("doubling_cube"));const p=n.actingPlayer===PlayerTurn.PLAYER_ONE;p?(d.style.display="flex",d.querySelector("#offered_cube").innerText=n.newGameValue,i.push(a)):(a.style.display="flex",a.querySelector("#offered_cube").innerText=n.newGameValue,i.push(d)),hideUIElements(i),observedGameState.isPaused||setupTimerForPlayer(!p);break;case ActionType.TAKE_DOUBLE:const E=n.playerTaking===PlayerTurn.PLAYER_ONE;observedGameState.currentGameValue=n.currentGameValue,i.push(l,a,r,u,d,y),E?(o.querySelector(".double_button").style.display="block",s.style.display="flex",s.querySelector(".double_button").style.display="none",i.push(o),f?(T.style.transform="rotate(90deg)",_.style.alignItems="start"):(T.style.transform="rotate(180deg)",_.style.justifyContent="start")):n.playerTaking===PlayerTurn.PLAYER_TWO&&(o.style.display="flex",i.push(s),o.querySelector(".double_button").style.display="none",s.querySelector(".double_button").style.display="block",f?(T.style.transform="rotate(-90deg)",_.style.alignItems="end"):(T.style.transform="rotate(0deg)",_.style.justifyContent="end")),document.getElementById("doubling_cube").style.display="flex",hideUIElements(i),observedGameState.isPaused||setupTimerForPlayer(!E);break;case ActionType.END_GAME:if(r.style.display="flex",y.style.display="flex",hideUIElements([l,a,o,u,d,s]),f?(T.style.transform="rotate(0deg)",_.style.alignItems="center"):(T.style.transform="rotate(90deg)",_.style.justifyContent="center"),n.actingPlayer!==null){const S=n.actingPlayer===PlayerTurn.PLAYER_TWO;handlePlayerWin(S,n.currentGameValue)}break;default:console.log("Either leak via lack of break or action type not handled");break}}else if(t==="forceStopTimer"&&n===!0)clearTimeout(e.playerTwoTimeoutId),e.playerTwoTimeoutId=null,clearTimeout(e.playerOneTimeoutId),e.playerOneTimeoutId=null;else if(t==="currentGameValue"){const i=document.getElementById("doubling_cube");i.innerText=n===1?"64":n}else t==="playerOneScore"?(document.getElementById("player_one_score").innerText=n,n>=observedMatchParameters.scoreLimit&&showAlert(`${observedMatchParameters.playerOneName} wins`,`${observedMatchParameters.playerOneName} won the game to ${observedMatchParameters.scoreLimit}`,!0,()=>{fullReset()},!0,void 0)):t==="playerOneGames"?document.getElementById("player_one_games").innerText=formatGamesValue(n):t==="playerTwoScore"?(document.getElementById("player_two_score").innerText=n,n>=observedMatchParameters.scoreLimit&&showAlert(`${observedMatchParameters.playerTwoName} wins`,`${observedMatchParameters.playerTwoName} won the game to ${observedMatchParameters.scoreLimit}`,!1,()=>{fullReset()},!0,void 0)):t==="playerTwoGames"?document.getElementById("player_two_games").innerText=formatGamesValue(n):t==="playerOneReserveTimeRemainingMs"?document.getElementById("player_one_reserve_time").innerText=formatReserveTime(n):t==="playerTwoReserveTimeRemainingMs"?document.getElementById("player_two_reserve_time").innerText=formatReserveTime(n):t==="playerOneTotalTimeRemainingMs"?document.getElementById("player_one_total_time").innerText=formatTotalTime(n):t==="playerTwoTotalTimeRemainingMs"&&(document.getElementById("player_two_total_time").innerText=formatTotalTime(n));return Reflect.set(e,t,n)}},observedGameState=new Proxy(gameState,handleGameStateChange);function resetGameState(){observedGameState.forceStopTimer=!0,observedGameState.currentAction=STARTING_ACTION,observedGameState.currentGameValue=1,observedGameState.playerOneGames=0,observedGameState.playerOneScore=0,observedGameState.playerOneTotalTimeRemainingMs=observedMatchParameters.totalGameTimeMs,observedGameState.playerOneReserveTimeRemainingMs=observedMatchParameters.reserveTimeMs,observedGameState.playerTwoGames=0,observedGameState.playerTwoScore=0,observedGameState.playerTwoTotalTimeRemainingMs=observedMatchParameters.totalGameTimeMs,observedGameState.playerTwoReserveTimeRemainingMs=observedMatchParameters.reserveTimeMs}function pauseGame(){observedGameState.forceStopTimer=!0,observedGameState.isPaused=!0,Array.from(document.getElementsByClassName("play_button")).forEach(function(e){e.style.display="block"}),Array.from(document.getElementsByClassName("pause_button")).forEach(function(e){e.style.display="none"}),document.getElementById("unclickable_overlay").style.display="block"}function resumeGame(){observedGameState.forceStopTimer=!1,observedGameState.isPaused=!1,Array.from(document.getElementsByClassName("play_button")).forEach(function(e){e.style.display="none"}),Array.from(document.getElementsByClassName("pause_button")).forEach(function(e){e.style.display="block"}),document.getElementById("unclickable_overlay").style.display="none",observedGameState.currentAction.type===ActionType.END_TURN?setupTimerForPlayer(observedGameState.currentAction.actingPlayer!==PlayerTurn.PLAYER_ONE):observedGameState.currentAction.type!==ActionType.END_GAME&&setupTimerForPlayer(observedGameState.currentAction.actingPlayer===PlayerTurn.PLAYER_ONE)}function loadStateFromLocalStorage(e){try{const t=localStorage.getItem(e);return t===null?void 0:JSON.parse(t)}catch(t){console.error("Error loading state from local storage:",t);return}}function saveStateToLocalStorage(e,t){try{const n=JSON.stringify(t);localStorage.setItem(e,n)}catch(n){console.error("Error saving state to local storage:",n)}}function formatGamesValue(e){return`(${e})`}function formatReserveTime(e){return`(${String(e/1e3).padStart(2,"0")})`}function formatTotalTime(e){const t=String(Math.trunc(e/6e4)).padStart(2,"0"),n=String(e%6e4/1e3).padStart(2,"0");return`${t}:${n}`}function isFirstGame(){return gameState.playerOneScore===0&&gameState.playerTwoScore===0}function isPlayerOneUIElement(e){let t=e;for(;!t.dataset.hasOwnProperty("playerId");)t=t.parentElement,t===null&&console.error("Unable to find which player clicked");return t.dataset.playerId==="1"}function onClickConcede(e){setupConcedeDialog(e),document.getElementById("concede_dialog").showModal()}function onClickSettings(){setupSettingsDialog(),document.getElementById("settings_dialog").showModal()}function showAlert(e,t,n,o,l,a){const r=document.getElementById("alert_dialog");document.getElementById("alert_title").innerText=e,document.getElementById("alert_content").innerText=t,n&&(r.style.transform="rotate(180deg)");const m=new AbortController,c=m.signal,s=document.getElementById("close_alert");l?s.style.display="none":(s.style.display="block",s.addEventListener("click",u=>{r.close(),a()},{signal:c})),document.getElementById("ok_alert").addEventListener("click",u=>{r.close(),o()},{signal:c}),r.addEventListener("close",()=>{r.style.transform="rotate(0deg)",m.abort()},{once:!0}),r.showModal()}function alertToAcceptConcede(e,t){const n=e?observedMatchParameters.playerOneName:observedMatchParameters.playerTwoName;showAlert(`Accept ${t} points?`,`${n} is offering to concede the game with ${t} points. Do you accept?`,!e,()=>{const o=new EndGameAction(getPlayerTurn(e),t);UNDO_REDO_BUFFER.add_to_history(o),observedGameState.currentAction=o,document.getElementById("concede_dialog").close()},!1,()=>{document.getElementById("concede_dialog").close()})}function setupSidebar(){Array.from(document.getElementsByClassName("concede_button")).forEach(function(e){e.onclick=()=>onClickConcede(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("settings_button")).forEach(function(e){e.onclick=onClickSettings}),Array.from(document.getElementsByClassName("play_button")).forEach(function(e){e.onclick=resumeGame}),Array.from(document.getElementsByClassName("pause_button")).forEach(function(e){e.onclick=pauseGame}),Array.from(document.getElementsByClassName("undo_button")).forEach(function(e){e.onclick=onClickUndo}),Array.from(document.getElementsByClassName("redo_button")).forEach(function(e){e.onclick=onClickRedo})}function setupConcedeDialog(e){const t=document.getElementById("concede_dialog");e&&(t.style.transform="rotate(180deg)");const n=new AbortController,o=n.signal,l=document.getElementById("concede_one_match");l.innerText=`Concede ${gameState.currentGameValue}`,l.addEventListener("click",c=>{alertToAcceptConcede(e,gameState.currentGameValue)},{signal:o});const a=document.getElementById("concede_two_match");a.innerText=`Concede ${gameState.currentGameValue*2}`,a.addEventListener("click",c=>{alertToAcceptConcede(e,gameState.currentGameValue*2)},{signal:o});const r=document.getElementById("concede_three_match");r.innerText=`Concede ${gameState.currentGameValue*3}`,r.addEventListener("click",c=>{alertToAcceptConcede(e,gameState.currentGameValue*3)},{signal:o}),document.getElementById("concede_game").addEventListener("click",c=>{handlePlayerWin(!e,1,!0),t.close()},{signal:o}),document.getElementById("close_concede").addEventListener("click",c=>{t.close()},{signal:o}),t.addEventListener("close",()=>{t.style.transform="rotate(0deg)",n.abort()},{once:!0})}function setupSettingsDialog(){const e=document.getElementById("settings_dialog"),t=document.getElementById("settings_form"),n=document.getElementById("close_settings"),o=document.getElementById("save_settings");document.getElementById(observedMatchParameters.theme).selected=!0,document.getElementById(observedMatchParameters.startType).selected=!0,document.getElementById("useCube").checked=observedMatchParameters.useCube,document.getElementById("useDice").checked=observedMatchParameters.useDice,document.getElementById("useTimer").checked=observedMatchParameters.useTimer,document.getElementById("scoreLimit").value=observedMatchParameters.scoreLimit,document.getElementById("playerOneName").value=observedMatchParameters.playerOneName,document.getElementById("playerTwoName").value=observedMatchParameters.playerTwoName;const l=observedMatchParameters.totalGameTimeMs;document.getElementById("formTotalGameTimeMinutes").value=Math.floor(l/6e4),document.getElementById("formTotalGameTimeSeconds").value=l%6e4/1e3,document.getElementById("formReserveTimeSeconds").value=observedMatchParameters.reserveTimeMs/1e3;const a=new AbortController,r=a.signal;n.addEventListener("click",()=>{e.close()},{signal:r}),o.addEventListener("click",m=>{showAlert("Change settings?","Changing the settings will reset the game. Are you sure you want to change?",!1,()=>{if(m.preventDefault(),!t.checkValidity()){t.reportVailidity(),showFeedback("Please fill out all fields in the form",!1);return}let c=0;for(const s of t.elements)s.name&&s.type!=="submit"&&s.type!=="button"&&(s.type==="checkbox"?observedMatchParameters[s.name]=s.checked:s.name==="formTotalGameTimeMinutes"?c+=+s.value*60:s.name==="formTotalGameTimeSeconds"?c+=+s.value:s.name==="formReserveTimeSeconds"?observedMatchParameters.reserveTimeMs=+s.value*1e3:s.name==="scoreLimit"?observedMatchParameters.scoreLimit=+s.value:observedMatchParameters[s.name]=s.value);observedMatchParameters.totalGameTimeMs=c*1e3,saveStateToLocalStorage(MATCH_PARAMETERS_KEY,observedMatchParameters),fullReset(),e.close()},!1,()=>{e.close()})},{signal:r}),e.addEventListener("close",()=>{a.abort()},{once:!0})}function setGenericGameStateBasedOnAction(e){observedGameState.playerOneTotalTimeRemainingMs=e.playerOneTotalTimeRemainingMs,observedGameState.playerTwoTotalTimeRemainingMs=e.playerTwoTotalTimeRemainingMs,observedGameState.playerOneReserveTimeRemainingMs=e.playerOneReserveTimeRemainingMs,observedGameState.playerTwoReserveTimeRemainingMs=e.playerTwoReserveTimeRemainingMs,observedGameState.playerOneGames=e.playerOneGames,observedGameState.playerOneScore=e.playerOneScore,observedGameState.playerTwoGames=e.playerTwoGames,observedGameState.playerTwoScore=e.playerTwoScore,observedGameState.currentGameValue=e.currentGameValue,observedGameState.currentAction=e}function onClickRedo(){if(!UNDO_REDO_BUFFER.can_redo()){console.log("Tried to redo with no actions left");return}pauseGame();const e=UNDO_REDO_BUFFER.redo();setGenericGameStateBasedOnAction(e)}function onClickUndo(){if(!UNDO_REDO_BUFFER.can_undo()){console.log("Tried to undo with no actions left");return}pauseGame(),UNDO_REDO_BUFFER.undo(),setGenericGameStateBasedOnAction(UNDO_REDO_BUFFER.u_peek())}function onClickDone(e){const t=new EndTurnAction(getPlayerTurn(e));UNDO_REDO_BUFFER.add_to_history(t),observedGameState.currentAction=t}function onClickDouble(e){const t=new OfferDoubleAction(getPlayerTurn(e));UNDO_REDO_BUFFER.add_to_history(t),observedGameState.currentAction=t}function onClickDoubleTake(e){const t=new TakeDoubleAction(getPlayerTurn(e));UNDO_REDO_BUFFER.add_to_history(t),observedGameState.currentAction=t}function onClickDoubleDrop(e){const t=new EndGameAction(getPlayerTurn(e));UNDO_REDO_BUFFER.add_to_history(t),observedGameState.currentAction=t}function onClickRoll(e){let t=Math.floor(Math.random()*6)+1,n=Math.floor(Math.random()*6)+1;const o=new RollAction(getPlayerTurn(e),t,n);observedGameState.currentAction=o,UNDO_REDO_BUFFER.add_to_history(o)}function onClickStart(e){let t;observedMatchParameters.startType===StartType.ALWAYS_RANDOM||observedMatchParameters.startType===StartType.FIRST_GAME_RANDOM&&isFirstGame()?t=Math.floor(Math.random()*10)%2===0:t=e;let n=getPlayerTurn(t);const o=new StartAction(n);observedGameState.currentAction=o,UNDO_REDO_BUFFER.add_to_history(o)}function setupMainButtons(){Array.from(document.getElementsByClassName("start_button")).forEach(function(e){e.onclick=()=>onClickStart(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("double_drop_button")).forEach(function(e){e.onclick=()=>onClickDoubleDrop(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("double_take_button")).forEach(function(e){e.onclick=()=>onClickDoubleTake(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("double_button")).forEach(function(e){e.onclick=()=>onClickDouble(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("roll_button")).forEach(function(e){e.onclick=()=>onClickRoll(isPlayerOneUIElement(e))}),Array.from(document.getElementsByClassName("done_button")).forEach(function(e){e.onclick=()=>onClickDone(isPlayerOneUIElement(e))})}function setupTimerForPlayer(e){if(!observedMatchParameters.useTimer)return;let t;function n(){if(gameState.forceStopTimer)return;e?gameState.playerOneReserveTimeRemainingMs>0?observedGameState.playerOneReserveTimeRemainingMs-=1e3:(observedGameState.playerOneTotalTimeRemainingMs-=1e3,gameState.playerOneTotalTimeRemainingMs<=0&&handlePlayerWin(!1,1,!0)):gameState.playerTwoReserveTimeRemainingMs>0?observedGameState.playerTwoReserveTimeRemainingMs-=1e3:(observedGameState.playerTwoTotalTimeRemainingMs-=1e3,gameState.playerTwoTotalTimeRemainingMs<=0&&handlePlayerWin(!0,1,!0));const a=Date.now()-t;t+=1e3;const r=setTimeout(n,Math.max(0,1e3-a));e?observedGameState.playerOneTimeoutId=r:observedGameState.playerTwoTimeoutId=r}t=Date.now()+1e3;const o=setTimeout(n,1e3);e?(observedGameState.playerOneTimeoutId=o,clearTimeout(gameState.playerTwoTimeoutId),observedGameState.playerTwoTimeoutId=null,observedGameState.playerTwoReserveTimeRemainingMs=observedMatchParameters.reserveTimeMs):(observedGameState.playerTwoTimeoutId=o,clearTimeout(gameState.playerOneTimeoutId),observedGameState.playerOneTimeoutId=null,observedGameState.playerOneReserveTimeRemainingMs=observedMatchParameters.reserveTimeMs)}function handlePlayerWin(e,t,n=!1){const o=t;if(e){if(observedGameState.playerOneGames+=1,observedGameState.playerOneScore+=o,n){observedGameState.playerOneScore+=+observedMatchParameters.scoreLimit;return}}else if(observedGameState.playerTwoGames+=1,observedGameState.playerTwoScore+=o,n){observedGameState.playerTwoScore+=+observedMatchParameters.scoreLimit;return}observedGameState.currentGameValue=1,document.getElementById("doubling_cube").style.display="flex",clearTimeout(gameState.playerTwoTimeoutId),observedGameState.playerTwoTimeoutId=null,clearTimeout(gameState.playerOneTimeoutId),observedGameState.playerOneTimeoutId=null,document.getElementById("player_two_reserve_time").innerText=formatReserveTime(observedMatchParameters.reserveTimeMs),document.getElementById("player_one_reserve_time").innerText=formatReserveTime(observedMatchParameters.reserveTimeMs),Array.from(document.getElementsByClassName("main_ui")).forEach(function(l){l.style.display="none",l.querySelector(".double_button").style.display="block"}),Array.from(document.getElementsByClassName("roll_action_ui")).forEach(function(l){l.style.display="none"}),Array.from(document.getElementsByClassName("double_action_ui")).forEach(function(l){l.style.display="none"}),Array.from(document.getElementsByClassName("start_ui")).forEach(function(l){l.style.display="flex"})}function fullReset(){resetGameState(),resetUI()}function resetUI(){Array.from(document.getElementsByClassName("main_ui")).forEach(function(e){e.style.display="none"}),Array.from(document.getElementsByClassName("roll_action_ui")).forEach(function(e){e.style.display="none"}),Array.from(document.getElementsByClassName("double_action_ui")).forEach(function(e){e.style.display="none"}),Array.from(document.getElementsByClassName("start_ui")).forEach(function(e){e.style.display="flex"})}document.addEventListener("DOMContentLoaded",()=>{resetMatchParameters();const e=loadStateFromLocalStorage(MATCH_PARAMETERS_KEY);for(const n in e)observedMatchParameters[n]=e[n];resetGameState();const t=loadStateFromLocalStorage(GAME_STATE_KEY);for(const n in t)observedGameState[n]=t[n];setupSidebar(),setupMainButtons()});
